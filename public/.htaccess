RewriteEngine On
# HTTPSへリダイレクト
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# www付きにリダイレクト
RewriteCond %{HTTP_HOST} !^www\.
RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]


<IfModule mod_deflate.c>
	SetOutputFilter DEFLATE
	
# Exclude images and compressed content from compression
	SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
	
	AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css
	AddOutputFilterByType DEFLATE application/xhtml+xml application/xml application/rss+xml
	AddOutputFilterByType DEFLATE application/atom_xml application/javascript application/x-javascript
	AddOutputFilterByType DEFLATE application/x-httpd-php application/x-font-ttf application/x-font-opentype application/x-font-woff application/x-font-woff2
	
# Headers for avoiding wrong content distribution by proxies
	Header append Vary Accept-Encoding env=!dont-vary
</IfModule>