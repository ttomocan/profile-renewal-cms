@use '../../global' as *;

/* =============================== */
/* Back to Top ボタン（スクロール進捗リング付き）
================================== */

.c-backtotop {
  --p: 0%;

  position: fixed;
  right: 20px;
  bottom: calc(20px + env(safe-area-inset-bottom, 0px));
  @include z-index(pagetop);

  width: 56px;
  height: 56px;
  padding: 0;
  border: none;
  border-radius: 50%;
  cursor: pointer;

  /*
   * 進捗リング:
   *   1) radial-gradient で中央を白く塗り（輪の「中抜き」）
   *   2) conic-gradient で外周リングを描画
   *     - 進捗色（オレンジ）: 0% 〜 var(--p)
   *     - トラック色（グレー）: var(--p) 〜 360deg
   */
  background:
    radial-gradient(circle, #fff 64%, transparent 65%),
    conic-gradient(from -90deg, $mainC var(--p), rgba(0, 0, 0, 0.1) var(--p));

  box-shadow:
    0 2px 16px rgba(0, 0, 0, 0.1),
    inset 0 0 0 1px rgba(0, 0, 0, 0.04);

  /* 初期: 非表示 */
  opacity: 0;
  visibility: hidden;
  transform: translateY(8px);
  transition:
    opacity 0.35s ease,
    visibility 0.35s ease,
    transform 0.35s ease,
    box-shadow 0.3s ease;

  /* フェードイン */
  &.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  /* ---- 矢印（CSS擬似要素で描画） ---- */

  /* 矢羽根（上向きV字: border-top + border-right を -45deg 回転） */
  &::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 10px;
    height: 10px;
    border-top: 2px solid $textC;
    border-right: 2px solid $textC;
    transform: translate(-50%, -20%) rotate(-45deg);
  }

  /* 棒（矢の軸） */
  &::after {
    content: '';
    position: absolute;
    top: calc(50% + 3px);
    left: 50%;
    width: 2px;
    height: 12px;
    background: $textC;
    transform: translate(-50%, -50%);
    border-radius: 1px;
  }

  /* ---- 状態変化 ---- */

  /* hover: 軽く浮かせる（hover可能デバイスのみ） */
  @include hover {
    &.show:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
  }

  /* active: 少し沈む */
  &:active {
    transform: scale(0.98);
  }

  /* focus-visible: アウトライン表示 */
  &:focus-visible {
    outline: 2px solid $mainC;
    outline-offset: 3px;
  }

  &:focus:not(:focus-visible) {
    outline: none;
  }

  /* ---- モーション配慮 ---- */
  @media (prefers-reduced-motion: reduce) {
    transition:
      opacity 0.01s,
      visibility 0.01s;

    &.show:hover,
    &:active {
      transform: none;
    }
  }
}
